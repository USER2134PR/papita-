<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>ZHENTIO CHK</title>
	<link rel="icon" type="image/x-icon" href="favicon.ico">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />
	<style>
		body {
			background: #181A1E;
			color: #fff;
			padding: 1rem;
		}
		textarea {
			background: #181A1E;
			color: #fff;
			width: 100%;
			border-radius: 5px;
			border: 1px solid #88AADD;
			padding: 10px;
			resize: none;
		}
		textarea:focus {
			outline: none;
			box-shadow: none;
			border: 1px solid #88AADD;
		}
		button {
			padding: 10px 20px;
			background-color: #181A1E;
			color: white;
			border: none;
			cursor: pointer;
			border-radius: 5px;
			border: 1px solid #181A1E;
			margin-right: 5px;
		}
		button:hover {
			background-color: #181A1E;
			border: 1px solid #88AADD;
		}
		.container.text-white.rounded.shadow.p-3.my-4 {
			background: #181A1E;
			border-radius: 5px;
			border: 1px solid #88AADD;
		}
		#lives, #dies, #errors {
			max-height: 250px;
			overflow-y: auto;
			padding: 10px;
			border: 1px solid #88AADD;
			border-radius: 5px;
			background-color: #0F1116;
			color: #fff;
			margin-top: 10px;
			white-space: pre-wrap;
			word-break: break-word;
		}
	</style>
</head>
<body>
	<div class="container text-white rounded shadow p-3 my-4">
		<h3><i class="fas fa-cogs"></i> CHECKER ALL BINS</h3>
		<div class="mt-3">
			<button id="chk-start"><i class="fas fa-play"></i> Iniciar</button>
			<button id="chk-pause" disabled><i class="fas fa-pause"></i> Pausar</button>
			<button id="chk-stop" disabled><i class="fas fa-stop"></i> Parar</button>
			<button id="chk-clean"><i class="fas fa-trash-alt"></i> Limpar</button>
		</div>
		<div class="mt-3">
			<span class="badge badge-warning" id="estatus">Esperando inicio...</span>
		</div>
	</div>

	<div class="container p-0 shadow">
		<ul class="nav nav-tabs">
			<li class="nav-item">
				<a class="nav-link active" data-toggle="tab" href="#chk-home"><i class="far fa-credit-card"></i></a>
			</li>
			<li class="nav-item">
				<a class="nav-link" data-toggle="tab" href="#chk-lives"><i class="fa fa-thumbs-up fa-lg"></i></a>
			</li>
			<li class="nav-item">
				<a class="nav-link" data-toggle="tab" href="#chk-dies"><i class="fa fa-thumbs-down fa-lg"></i></a>
			</li>
			<li class="nav-item">
				<a class="nav-link" data-toggle="tab" href="#chk-errors"><i class="fas fa-times fa-lg"></i></a>
			</li>
		</ul>

		<div class="tab-content">
			<div class="tab-pane fade show active px-3 pt-4 pb-3" id="chk-home">
				<div class="my-2">
					Aprovadas: <span class="val-lives" style="font-weight: bold;">0</span>
					Reprovadas: <span class="val-dies" style="font-weight: bold;">0</span>
					Errors: <span class="val-errors" style="font-weight: bold;">0</span>
					Testadas: <span class="val-tested" style="font-weight: bold;">0</span>
					Total: <span class="val-total" style="font-weight: bold;">0</span>
				</div>

				<div class="mt-2">
					<label><i class="fas fa-cookie-bite"></i> Cookies</label>
					<textarea id="cookie_input" placeholder="Pega aquí tus cookies de Amazon..." rows="2"></textarea>
				</div>
				<div class="mt-2">
					<label><i class="far fa-credit-card"></i> Lista de tarjetas:</label>
					<textarea id="lista_cartoes" placeholder="Ingrese su lista..." rows="8"></textarea>
				</div>
			</div>

			<div class="tab-pane fade px-3 pt-4 pb-3" id="chk-lives">
				<h5>Aprovadas</h5>
				<div id="lives"></div>
			</div>
			<div class="tab-pane fade px-3 pt-4 pb-3" id="chk-dies">
				<h5>Reprovadas</h5>
				<div id="dies"></div>
			</div>
			<div class="tab-pane fade px-3 pt-4 pb-3" id="chk-errors">
				<h5>Erros</h5>
				<div id="errors"></div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

	<script>
		let paused = false;
		let tarjetas = [];
		let cookies = "";

		function resetContadores() {
			$(".val-lives, .val-dies, .val-errors, .val-tested, .val-total").text("0");
			$("#lives, #dies, #errors").html("");
		}

		function checkCard(card) {
			return $.ajax({
				url: "http://127.0.0.1:8000/check_card",
				method: "POST",
				contentType: "application/json",
				data: JSON.stringify({
					cookie: cookies,
					card: card
				})
			});
		}

		$("#chk-start").click(function () {
			cookies = $("#cookie_input").val().trim();
			tarjetas = $("#lista_cartoes").val().trim().split("\n").filter(l => l.trim() !== "");

			if (!cookies) {
				toastr.error("Por favor, ingresa las cookies primero.");
				return;
			}

			if (tarjetas.length === 0) {
				toastr.warning("No se ingresaron tarjetas.");
				return;
			}

			resetContadores();
			$("#estatus").text("Chequeando...");
			$(this).attr("disabled", true);
			$("#chk-pause, #chk-stop").attr("disabled", false);

			let index = 0;

			function next() {
				if (paused) {
					setTimeout(next, 500);
					return;
				}
				if (index >= tarjetas.length) {
					$("#estatus").text("Finalizado.");
					$("#chk-start").attr("disabled", false);
					$("#chk-pause, #chk-stop").attr("disabled", true);
					return;
				}

				let card = tarjetas[index++];
				$(".val-tested").text(index);
				$(".val-total").text(tarjetas.length);

				checkCard(card).done((response) => {
					if (response.status === "LIVE") {
						$("#lives").append(card + " → LIVE\n");
						$(".val-lives").text(parseInt($(".val-lives").text()) + 1);
					} else if (response.status === "DEAD") {
						$("#dies").append(card + " → DEAD\n");
						$(".val-dies").text(parseInt($(".val-dies").text()) + 1);
					} else {
						$("#errors").append(card + " → ERROR\n");
						$(".val-errors").text(parseInt($(".val-errors").text()) + 1);
					}
				}).fail(() => {
					$("#errors").append(card + " → ERROR\n");
					$(".val-errors").text(parseInt($(".val-errors").text()) + 1);
				}).always(() => {
					next();
				});
			}

			next();
		});

		$("#chk-pause").click(function () {
			paused = !paused;
			$(this).html(paused ? '<i class="fas fa-play"></i> Reanudar' : '<i class="fas fa-pause"></i> Pausar');
		});

		$("#chk-stop").click(function () {
			paused = true;
			$("#estatus").text("Parado.");
			$("#chk-start").attr("disabled", false);
			$("#chk-pause, #chk-stop").attr("disabled", true);
		});

		$("#chk-clean").click(function () {
			$("#lista_cartoes, #cookie_input, #lives, #dies, #errors").val("").html("");
			resetContadores();
			$("#estatus").text("Esperando inicio...");
		});
	</script>
</body>
</html>
